# –ó–≤—ë–∑–¥–Ω–æ–µ –í–µ—Ä–µ—Ç–µ–Ω–æ - –õ–∏—á–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç—ã –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

–õ–∏—á–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∏–≥—Ä—ã –ø–æ –ù–†–ò "–ó–≤—ë–∑–¥–Ω–æ–µ –í–µ—Ä–µ—Ç–µ–Ω–æ" —Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **Frontend**: Next.js 15 (App Router) + React 18 + TypeScript
- **UI**: Tailwind CSS + shadcn/ui
- **Backend**: Next.js API Routes + Server Actions
- **Database**: PostgreSQL + Drizzle ORM
- **Auth**: NextAuth v4 (email + –ø–∞—Ä–æ–ª—å; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ Telegram OAuth)
- **Storage**: MinIO (S3 API)
- **Payments**: YooKassa

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+
- pnpm 8+
- Docker & Docker Compose

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone <repository-url>
cd zvezdnoe-vereteno
pnpm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª
```

### 3. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```bash
docker-compose up -d postgres minio
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
pnpm db:generate
pnpm db:migrate
pnpm db:seed
```

### 5. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
pnpm dev
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:3000

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
apps/
  web/                # Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (BFF + UI)
packages/
  db/                 # Drizzle ORM: —Å—Ö–µ–º–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
  ui/                 # –û–±—â–∏–π UI-–∫–∏—Ç
  contracts/          # –¢–∏–ø—ã, DTO, —Å–æ–±—ã—Ç–∏—è
  utils/              # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
```

## üîß –ö–æ–º–∞–Ω–¥—ã

- `pnpm dev` - –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- `pnpm build` - –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- `pnpm db:generate` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π (Drizzle)
- `pnpm db:migrate` - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (Drizzle)
- `pnpm db:seed` - –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- `pnpm db:studio` - –û—Ç–∫—Ä—ã—Ç–∏–µ Drizzle Studio

## üß™ How to test auth (step 1)

- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –Ω–∞ `:3001`, –µ—Å–ª–∏ `:3000` –∑–∞–Ω—è—Ç. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥ `next dev`.
- –û—Ç–∫—Ä–æ–π—Ç–µ `/auth/register` ‚Äî –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤ –ë–î –ø–æ—è–≤–∏—Ç—Å—è `password_hash`).
- –û—Ç–∫—Ä–æ–π—Ç–µ `/auth/login` ‚Äî –≤–æ–π–¥–∏—Ç–µ email+–ø–∞—Ä–æ–ª—å. –ü—Ä–∏ —É—Å–ø–µ—Ö–µ –ø–æ–ø–∞–¥—ë—Ç–µ –Ω–∞ `/player`.
- –ë–µ–∑ —Å–µ—Å—Å–∏–∏ –¥–æ—Å—Ç—É–ø –∫ `/player|/master|/admin` —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `/auth/login` (–ø—Ä–æ–≤–µ—Ä–∫–∞ cookie `next-auth`).
- –í —Ö–µ–¥–µ—Ä–µ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ ¬´–í—ã–π—Ç–∏¬ª ‚Äî –≤–µ—Ä–Ω—ë—Ç –Ω–∞ `/auth/login` –∏ —É–¥–∞–ª–∏—Ç —Å–µ—Å—Å–∏—é.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- Auth: NextAuth Credentials (JWT —Å—Ç—Ä–∞—Ç–µ–≥–∏—è). –í jwt/session –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è `id` –∏ `roles`.
- –ë—ç–∫–µ–Ω–¥: Drizzle ORM, —Ç–∞–±–ª–∏—Ü—ã `users`, `user_roles`. –ü–∞—Ä–æ–ª—å ‚Äî `bcryptjs.hashSync(password, 12)`.
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: `POST /api/auth/register` ‚Üí 201 `{ ok: true }` –∏–ª–∏ 409 –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ email.
- –õ–æ–≥–∏–Ω: –∫–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `signIn('credentials', { redirect: false })`; –ø—Ä–∏ —É—Å–ø–µ—Ö–µ ‚Äî –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/player`.

### ENV (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–ó–∞–¥–∞–π—Ç–µ –≤ –∫–æ—Ä–Ω–µ–≤–æ–º `.env`:

```
DATABASE_URL=postgresql://zv_user:zv_password@localhost:5433/zvezdnoe_vereteno
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=dev-secret
```

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª `.env` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ —Å–∏–º–ª–∏–Ω–∫ `.env.local`.

### Troubleshooting

- –°–µ—Ä–≤–µ—Ä –ø–æ–¥–Ω—è–ª—Å—è –Ω–∞ `:3001`: –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –Ω–∞ `http://localhost:3001`.
- –û—à–∏–±–∫–∞ –º–æ–¥—É–ª—è `bcrypt`: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `bcryptjs` (JS-–≤–µ—Ä—Å–∏—è). –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: `pnpm -C apps/web i`.

### –ü–µ—Ä–µ–Ω–æ—Å –Ω–∞ –¥—Ä—É–≥—É—é –º–∞—à–∏–Ω—É

–°–º. –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –≤ `project_docs/MIGRATION.md` (–±—ç–∫–∞–ø/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î, –ø–µ—Ä–µ–Ω–æ—Å MinIO, env).
- –í URL –≤–∏–¥–Ω—ã `?email=&password=`: –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞–ø—Ä—è–º—É—é, —Ñ–æ—Ä–º—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è POST –∏ –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã; —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å—Å—ã–ª–∫–∏ —Å query –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

## üåê –î–æ–º–µ–Ω—ã

- **–û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç**: zvezdnoe-vereteno.ru (Tilda)
- **–õ–∏—á–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç—ã**: app.zvezdnoe-vereteno.ru (Next.js)

## üìã TODO

- [x] –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–Ω–æ—Ä–µ–ø–æ
- [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Next.js —Å App Router
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Prisma + PostgreSQL
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NextAuth
- [x] –ë–∞–∑–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] API —Ä–æ—É—Ç—ã –∏ RBAC
- [ ] UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (shadcn/ui)
- [ ] –õ–∏—á–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç—ã (–ò–≥—Ä–æ–∫, –ú–∞—Å—Ç–µ—Ä, –ê–¥–º–∏–Ω)
- [ ] –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –∏ –±–∞—Ç—Ç–ª–ø–∞—Å—Å–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å YooKassa
- [ ] –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
