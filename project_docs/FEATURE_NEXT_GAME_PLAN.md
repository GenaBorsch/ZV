# –¢–ó: –ü–ª–∞–Ω –º–∞—Å—Ç–µ—Ä–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –∏–≥—Ä—É –∏ —Å–µ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π

**–í–µ—Ä—Å–∏—è:** 2.0 (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ—Å–ª–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–≤—å—é)  
**–î–∞—Ç–∞:** 16 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## üéØ –¶–µ–ª—å –∏ —Ü–µ–Ω–Ω–æ—Å—Ç—å

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ç—á—ë—Ç–∞ –æ –ø—Ä–æ—à–µ–¥—à–µ–π –∏–≥—Ä–µ –º–∞—Å—Ç–µ—Ä **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–±–∏—Ä–∞–µ—Ç "—Å–µ—Ç–∫—É"** –∏–∑ 4 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å–µ—Å—Å–∏—é:
- **–ú–æ–Ω—Å—Ç—Ä** (–æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å —Å –∫–∞—Ä—Ç–æ—á–∫–æ–π)
- **–õ–æ–∫–∞—Ü–∏—è** (—Ç–µ–∫—Å—Ç–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç)
- **–û—Å–Ω–æ–≤–Ω–æ–µ —Å—é–∂–µ—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ** (—Ç–µ–∫—Å—Ç–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç)
- **–í—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ** (—Ç–µ–∫—Å—Ç–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç)

**–ö–ª—é—á–µ–≤—ã–µ —Ñ–∏—á–∏:**
1. –ö–Ω–æ–ø–∫–∞ **"–ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç"** ‚Äî –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ–π —Å–µ—Ç–∫–∏ —Å–ª—É—á–∞–π–Ω—ã–º–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
2. –§–ª–∞–≥ **"–≠—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ–π —Å–µ—Å—Å–∏–∏"** ‚Äî –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç —Ä–∞–Ω–µ–µ –∑–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã
3. –ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –æ—Ç—á—ë—Ç–∞ (APPROVED) —ç–ª–µ–º–µ–Ω—Ç—ã **–±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞** –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥—Ä—É–≥–∏–º –º–∞—Å—Ç–µ—Ä–∞–º
4. –ú–∞—Å—Ç–µ—Ä –¥–æ–ø–∏—Å—ã–≤–∞–µ—Ç **—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–ª–∞–Ω** —Å–ª–µ–¥—É—é—â–µ–π –∏–≥—Ä—ã (–¥–æ 2000 —Å–∏–º–≤–æ–ª–æ–≤)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### ‚úÖ –ü—Ä–∏–Ω—è—Ç—ã–µ —É–ø—Ä–æ—â–µ–Ω–∏—è

| –í–æ–ø—Ä–æ—Å | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|
| **–†–µ–∑–µ—Ä–≤—ã/TTL** | ‚ùå –ù–µ—Ç. –ò—Å–ø–æ–ª—å–∑—É–µ–º **–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ç—á—ë—Ç–∞ |
| **–ú–æ–Ω—Å—Ç—Ä—ã vs —Ç–µ–∫—Å—Ç—ã** | üîÑ **–î–≤–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã** (—É –º–æ–Ω—Å—Ç—Ä–æ–≤ –±—É–¥—É—â–∏–µ —Ñ–∏—á–∏) |
| **–°–≤—è–∑—å —Å –≥—Ä—É–ø–ø–∞–º–∏** | ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º `groupId` –≤ —Ç–∞–±–ª–∏—Ü—É `reports` |
| **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞–≤—Å–µ–≥–¥–∞** | ‚úÖ –î–∞, –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏ –¥–µ–ª–∞—Ç—å —Ä—É—á–Ω–æ–π unlock |
| **"–ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç"** | ‚úÖ –û—Å—Ç–∞–≤–ª—è–µ–º –≤ MVP |
| **–ê–¥–º–∏–Ω–∫–∞** | üìÇ `/admin/monsters` ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ, `/admin/story-pool` ‚Äî –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤ |

---

## üìä –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (Drizzle)

### 1. –¢–∞–±–ª–∏—Ü–∞ `monsters`

```sql
CREATE TABLE monsters (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(200) NOT NULL UNIQUE,
  image_url VARCHAR(512),
  description TEXT NOT NULL,
  last_known_location VARCHAR(200),
  bounty_alive INTEGER,
  bounty_dead INTEGER,
  
  -- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞
  status VARCHAR(20) DEFAULT 'AVAILABLE' NOT NULL, -- AVAILABLE | LOCKED
  locked_by_report_id UUID REFERENCES reports(id),
  locked_by_group_id UUID REFERENCES groups(id),
  locked_at TIMESTAMP,
  
  is_active BOOLEAN DEFAULT TRUE NOT NULL,
  created_at TIMESTAMP DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW() NOT NULL
);

CREATE INDEX idx_monsters_status ON monsters(status) WHERE is_active = TRUE;
```

### 2. –¢–∞–±–ª–∏—Ü–∞ `story_texts`

```sql
CREATE TYPE story_text_type AS ENUM ('LOCATION', 'MAIN_EVENT', 'SIDE_EVENT');

CREATE TABLE story_texts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  type story_text_type NOT NULL,
  text TEXT NOT NULL, -- –æ—Ç –ø–∞—Ä—ã —Å–ª–æ–≤ –¥–æ –∞–±–∑–∞—Ü–∞
  
  -- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞
  status VARCHAR(20) DEFAULT 'AVAILABLE' NOT NULL, -- AVAILABLE | LOCKED
  locked_by_report_id UUID REFERENCES reports(id),
  locked_by_group_id UUID REFERENCES groups(id),
  locked_at TIMESTAMP,
  
  is_active BOOLEAN DEFAULT TRUE NOT NULL,
  created_at TIMESTAMP DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW() NOT NULL,
  
  UNIQUE(type, text) -- –æ–¥–∏–Ω —Ç–µ–∫—Å—Ç –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö —Ç–∏–ø–∞
);

CREATE INDEX idx_story_texts_type_status ON story_texts(type, status) WHERE is_active = TRUE;
```

### 3. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `reports`

```sql
ALTER TABLE reports 
ADD COLUMN group_id UUID REFERENCES groups(id) NOT NULL;

CREATE INDEX idx_reports_group_status ON reports(group_id, status);
```

### 4. –¢–∞–±–ª–∏—Ü–∞ `report_next_plans`

```sql
CREATE TABLE report_next_plans (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  report_id UUID UNIQUE NOT NULL REFERENCES reports(id) ON DELETE CASCADE,
  
  -- –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ–π —Å–µ—Å—Å–∏–∏
  continued_from_report_id UUID REFERENCES reports(id),
  
  -- –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø–ª–∞–Ω
  next_plan_text TEXT NOT NULL CHECK (char_length(next_plan_text) <= 2000),
  
  -- –°–µ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π (4 —Å–ª–æ—Ç–∞)
  monster_id UUID NOT NULL REFERENCES monsters(id),
  location_text_id UUID NOT NULL REFERENCES story_texts(id),
  main_event_text_id UUID NOT NULL REFERENCES story_texts(id),
  side_event_text_id UUID NOT NULL REFERENCES story_texts(id),
  
  created_at TIMESTAMP DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMP DEFAULT NOW() NOT NULL,
  
  -- –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è
  CHECK (
    location_text_id != main_event_text_id AND
    location_text_id != side_event_text_id AND
    main_event_text_id != side_event_text_id
  )
);
```

---

## üîß API –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã

### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: –ú–æ–Ω—Å—Ç—Ä—ã

**–ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å:** `/api/admin/monsters`

#### GET `/api/admin/monsters`
–°–ø–∏—Å–æ–∫ –º–æ–Ω—Å—Ç—Ä–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.

**Query params:**
```typescript
{
  status?: 'AVAILABLE' | 'LOCKED',
  isActive?: boolean,
  search?: string, // –ø–æ–∏—Å–∫ –ø–æ title/description
  page?: number,
  limit?: number
}
```

**Response:**
```typescript
{
  data: Monster[],
  pagination: { total, page, limit, pages }
}
```

#### POST `/api/admin/monsters`
–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω—Å—Ç—Ä–∞.

**Body:**
```typescript
{
  title: string, // required, unique
  imageUrl?: string,
  description: string, // required
  lastKnownLocation?: string,
  bountyAlive?: number,
  bountyDead?: number
}
```

#### PATCH `/api/admin/monsters/:id`
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–Ω—Å—Ç—Ä–∞.

#### DELETE `/api/admin/monsters/:id`
–£–¥–∞–ª–µ–Ω–∏–µ –º–æ–Ω—Å—Ç—Ä–∞ (–∑–∞–ø—Ä–µ—â–µ–Ω–æ –µ—Å–ª–∏ `status = LOCKED`).

#### POST `/api/admin/monsters/:id/unlock`
–†—É—á–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (override) –∞–¥–º–∏–Ω–æ–º.

---

### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è

**–ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å:** `/api/admin/story-texts`

#### GET `/api/admin/story-texts`
–°–ø–∏—Å–æ–∫ —Ç–µ–∫—Å—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.

**Query params:**
```typescript
{
  type?: 'LOCATION' | 'MAIN_EVENT' | 'SIDE_EVENT',
  status?: 'AVAILABLE' | 'LOCKED',
  isActive?: boolean,
  search?: string,
  page?: number,
  limit?: number
}
```

#### POST `/api/admin/story-texts`
–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞.

**Body:**
```typescript
{
  type: 'LOCATION' | 'MAIN_EVENT' | 'SIDE_EVENT',
  text: string // required
}
```

#### PATCH `/api/admin/story-texts/:id`
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞.

#### DELETE `/api/admin/story-texts/:id`
–£–¥–∞–ª–µ–Ω–∏–µ (–∑–∞–ø—Ä–µ—â–µ–Ω–æ –µ—Å–ª–∏ `status = LOCKED`).

#### POST `/api/admin/story-texts/:id/unlock`
–†—É—á–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞.

---

### –ú–∞—Å—Ç–µ—Ä: –í—ã–±–æ—Ä —Å–µ—Ç–∫–∏

**–ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å:** `/api/story-pool`

#### GET `/api/story-pool/monsters/available`
–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–Ω—Å—Ç—Ä—ã –¥–ª—è –≤—ã–±–æ—Ä–∞.

**Query params:**
```typescript
{
  search?: string,
  limit?: number
}
```

**Response:**
```typescript
{
  data: Array<{
    id: string,
    title: string,
    imageUrl: string | null,
    description: string,
    lastKnownLocation: string | null,
    bountyAlive: number | null,
    bountyDead: number | null
  }>
}
```

#### GET `/api/story-pool/texts/available`
–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã.

**Query params:**
```typescript
{
  type: 'LOCATION' | 'MAIN_EVENT' | 'SIDE_EVENT',
  search?: string,
  limit?: number
}
```

#### POST `/api/story-pool/feeling-lucky`
–°–ª—É—á–∞–π–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ç–∫–∏.

**Body:**
```typescript
{
  groupId: string // –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ "–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è"
}
```

**Response:**
```typescript
{
  monsterId: string,
  locationTextId: string,
  mainEventTextId: string,
  sideEventTextId: string,
  elements: {
    monster: MonsterDto,
    location: StoryTextDto,
    mainEvent: StoryTextDto,
    sideEvent: StoryTextDto
  }
}
```

**–õ–æ–≥–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (status = AVAILABLE, isActive = true)
- –°–ª—É—á–∞–π–Ω–æ –≤—ã–±–∏—Ä–∞–µ—Ç –ø–æ 1 —ç–ª–µ–º–µ–Ω—Ç—É –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID –∏ –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–µ–≤—å—é

---

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –æ—Ç—á—ë—Ç—ã

#### POST `/api/reports`
–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π DTO).

**Body:**
```typescript
{
  groupId: string, // NEW!
  description: string,
  players: string[], // –º–∞—Å—Å–∏–≤ userId
  
  // NEW: –ü–ª–∞–Ω —Å–ª–µ–¥—É—é—â–µ–π –∏–≥—Ä—ã
  nextPlan: {
    continuedFromReportId?: string | null,
    nextPlanText: string, // max 2000 —Å–∏–º–≤–æ–ª–æ–≤
    monsterId: string,
    locationTextId: string,
    mainEventTextId: string,
    sideEventTextId: string
  }
}
```

**–°–µ—Ä–≤–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞:**
1. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ 4 —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–µ–π—á–∞—Å `status = AVAILABLE`
2. **–ê—Ç–æ–º–∞—Ä–Ω–æ** –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
   - –°–æ–∑–¥–∞—ë—Ç `report` (status = PENDING)
   - –°–æ–∑–¥–∞—ë—Ç `report_next_plans`
   - **–ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç** —ç–ª–µ–º–µ–Ω—Ç—ã (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ APPROVED)
3. –ï—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç —É–∂–µ LOCKED ‚Üí –æ—à–∏–±–∫–∞ 409:
   ```typescript
   {
     error: 'CONFLICT',
     conflicts: {
       monsterId?: 'LOCKED',
       locationTextId?: 'LOCKED',
       ...
     },
     alternatives: {
       monsters: Monster[], // –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
       locations: StoryText[],
       ...
     }
   }
   ```

#### PATCH `/api/reports/:id`
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ (–¥–æ –º–æ–¥–µ—Ä–∞—Ü–∏–∏).

- –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å `nextPlan` –µ—Å–ª–∏ –æ—Ç—á—ë—Ç –≤ —Å—Ç–∞—Ç—É—Å–µ `PENDING` –∏–ª–∏ `REJECTED`
- –ï—Å–ª–∏ `continuedFromReportId` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Äî –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å —Å–µ—Ç–∫—É (—Ç–æ–ª—å–∫–æ `nextPlanText`)

#### PATCH `/api/reports/:id` (–º–æ–¥–µ—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–æ–º)
–û–¥–æ–±—Ä–µ–Ω–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–∞.

**Body (–∞–¥–º–∏–Ω):**
```typescript
{
  status: 'APPROVED' | 'REJECTED',
  rejectionReason?: string // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏ REJECTED
}
```

**–°–µ—Ä–≤–µ—Ä–Ω—ã–π —Ö—É–∫ –ø—Ä–∏ APPROVED:**
```typescript
// 1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ—Ç—á—ë—Ç–∞
await db.update(reports).set({ status: 'APPROVED' })

// 2. –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ç–∫—É –∏–∑ report_next_plans
const plan = await db.select().from(reportNextPlans).where(...)

// 3. –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ 4 —ç–ª–µ–º–µ–Ω—Ç–∞ (–∞—Ç–æ–º–∞—Ä–Ω–æ)
await db.transaction(async (tx) => {
  await tx.update(monsters)
    .set({ 
      status: 'LOCKED',
      lockedByReportId: reportId,
      lockedByGroupId: groupId,
      lockedAt: new Date()
    })
    .where(eq(monsters.id, plan.monsterId))
  
  // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è 3 —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  await tx.update(storyTexts)...
})

// 4. –°–ø–∏—Å–∞—Ç—å –±–∞—Ç—Ç–ª–ø–∞—Å—Å—ã –∏–≥—Ä–æ–∫–æ–≤ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞)

// 5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–∞—Å—Ç–µ—Ä—É –∏ –∏–≥—Ä–æ–∫–∞–º
```

**–°–µ—Ä–≤–µ—Ä–Ω—ã–π —Ö—É–∫ –ø—Ä–∏ REJECTED:**
- –≠–ª–µ–º–µ–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è `AVAILABLE` (–æ–Ω–∏ –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏—Å—å)
- –ú–∞—Å—Ç–µ—Ä –º–æ–∂–µ—Ç –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç –∏ –≤—ã–±—Ä–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Ç–∫—É

---

## üé® UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

#### `/admin/monsters`
–û—Ç–¥–µ–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–Ω—Å—Ç—Ä–∞–º–∏.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- –¢–∞–±–ª–∏—Ü–∞ –º–æ–Ω—Å—Ç—Ä–æ–≤ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏: –ø—Ä–µ–≤—å—é, –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Å—Ç–∞—Ç—É—Å, –¥–µ–π—Å—Ç–≤–∏—è
- –§–∏–ª—å—Ç—Ä—ã: —Å—Ç–∞—Ç—É—Å (AVAILABLE/LOCKED), –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø–æ–∏—Å–∫
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ñ–æ—Ä–º–æ–π:
  - –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—á–µ—Ä–µ–∑ MinIO)
  - –ù–∞–∑–≤–∞–Ω–∏–µ (required, unique)
  - –û–ø–∏—Å–∞–Ω–∏–µ (required, textarea)
  - –ü–æ—Å–ª–µ–¥–Ω—è—è –ª–æ–∫–∞—Ü–∏—è
  - –ù–∞–≥—Ä–∞–¥—ã (—á–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è)
- –ö–Ω–æ–ø–∫–∞ "–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" –¥–ª—è LOCKED –º–æ–Ω—Å—Ç—Ä–æ–≤ (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
- –ò—Å—Ç–æ—Ä–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (–≤ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ)

#### `/admin/story-pool`
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- –¢–∞–±—ã –ø–æ —Ç–∏–ø–∞–º: –õ–æ–∫–∞—Ü–∏–∏ / –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è / –í—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- –¢–∞–±–ª–∏—Ü–∞ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏: —Ç–µ–∫—Å—Ç, —Å—Ç–∞—Ç—É—Å, –¥–µ–π—Å—Ç–≤–∏—è
- –§–∏–ª—å—Ç—Ä—ã: —Å—Ç–∞—Ç—É—Å, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø–æ–∏—Å–∫
- –ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
  - –¢–∏–ø (radio buttons / –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ç–∞–±—É)
  - –¢–µ–∫—Å—Ç (textarea, –¥–æ –∞–±–∑–∞—Ü–∞)
- –ö–Ω–æ–ø–∫–∞ "–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" –¥–ª—è LOCKED —ç–ª–µ–º–µ–Ω—Ç–æ–≤

---

### –ö–∞–±–∏–Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–∞

#### `/master/reports/create` (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)

**–ù–æ–≤—ã–π –±–ª–æ–∫: "–ü–ª–∞–Ω —Å–ª–µ–¥—É—é—â–µ–π –∏–≥—Ä—ã"**

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üìù –ü–ª–∞–Ω —Å–ª–µ–¥—É—é—â–µ–π –∏–≥—Ä—ã                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚òê –≠—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ–π —Å–µ—Å—Å–∏–∏        ‚îÇ  <- Checkbox
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –°–µ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π:                          ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ ‚îÇ –ú–û–ù–°–¢–† ‚îÇ ‚îÇ–õ–û–ö–ê–¶–ò–Ø ‚îÇ ‚îÇ–û–°–ù–û–í–ù–û–ï‚îÇ ‚îÇ–í–¢–û-‚îÇ‚îÇ
‚îÇ ‚îÇ        ‚îÇ ‚îÇ        ‚îÇ ‚îÇ        ‚îÇ ‚îÇ–†–û–°.‚îÇ‚îÇ
‚îÇ ‚îÇ [–≤—ã–±—Ä] ‚îÇ ‚îÇ [–≤—ã–±—Ä] ‚îÇ ‚îÇ [–≤—ã–±—Ä] ‚îÇ ‚îÇ[–≤.]‚îÇ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ        [üé≤ –ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç]                 ‚îÇ  <- –ö–Ω–æ–ø–∫–∞ —Ä–∞–Ω–¥–æ–º–∞
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞–Ω–∞:                         ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ [–¢–µ–∫—Å—Ç–æ–≤—ã–π –ø–ª–∞–Ω...]                 ‚îÇ ‚îÇ
‚îÇ ‚îÇ                                     ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ 0 / 2000 —Å–∏–º–≤–æ–ª–æ–≤                       ‚îÇ  <- –°—á—ë—Ç—á–∏–∫
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**UX-–ª–æ–≥–∏–∫–∞:**

1. **–ß–µ–∫–±–æ–∫—Å "–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ":**
   - –ï—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π APPROVED –æ—Ç—á—ë—Ç —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã
   - –°–µ—Ç–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è LOCKED —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –∏–∑ —Ç–æ–≥–æ –æ—Ç—á—ë—Ç–∞
   - –°–ª–æ—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è **disabled** (–Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å)
   - –ü–æ–ª–µ `nextPlanText` –∞–∫—Ç–∏–≤–Ω–æ (–º–æ–∂–Ω–æ –¥–æ–ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞–Ω)
   - –ö–Ω–æ–ø–∫–∞ "–ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç" —Å–∫—Ä—ã—Ç–∞

2. **–°–ª–æ—Ç—ã –≤—ã–±–æ—Ä–∞:**
   - **–ú–æ–Ω—Å—Ç—Ä:** –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –ø—Ä–µ–≤—å—é (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)
   - **–¢–µ–∫—Å—Ç–æ–≤—ã–µ:** –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç –≤ —Ä–∞–º–∫–µ
   - –ö–Ω–æ–ø–∫–∞ "–í—ã–±—Ä–∞—Ç—å" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ:
     - –î–ª—è –º–æ–Ω—Å—Ç—Ä–æ–≤: –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (grid)
     - –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤: —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫
     - –ü–æ–∏—Å–∫/—Ñ–∏–ª—å—Ç—Ä –≤ –º–æ–¥–∞–ª–∫–µ
   - –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å"

3. **–ö–Ω–æ–ø–∫–∞ "–ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç":**
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å `POST /api/story-pool/feeling-lucky`
   - –ó–∞–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ 4 —Å–ª–æ—Ç–∞ —Å–ª—É—á–∞–π–Ω—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç loader –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤) –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

4. **Textarea –ø–ª–∞–Ω–∞:**
   - –ñ–∏–≤–æ–π —Å—á—ë—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤
   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –ª–∏–º–∏—Ç—É (1900/2000)
   - –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è)

5. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π:**
   - –ï—Å–ª–∏ –ù–ï "–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ" ‚Üí –≤—Å–µ 4 —Å–ª–æ—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
   - `nextPlanText` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, max 2000 —Å–∏–º–≤–æ–ª–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–Ω–µ–ª—å–∑—è –æ–¥–∏–Ω —Ç–µ–∫—Å—Ç –≤ —Ä–∞–∑–Ω—ã–µ —Å–ª–æ—Ç—ã)

6. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (409):**
   - –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —É–∂–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥—Ä—É–≥–∏–º –º–∞—Å—Ç–µ—Ä–æ–º:
   - –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–≠–ª–µ–º–µ–Ω—Ç [–Ω–∞–∑–≤–∞–Ω–∏–µ] —É–∂–µ –∑–∞–Ω—è—Ç"
   - –ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–ª–æ—Ç—ã
   - –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª–∫—É —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏: "–í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —ç–ª–µ–º–µ–Ω—Ç"
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª –≤—ã–±–æ—Ä–∞ –¥–ª—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω–æ–≥–æ —Å–ª–æ—Ç–∞

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `NextGamePlanBlock.tsx` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫
- `StoryGridSelector.tsx` ‚Äî —Å–µ—Ç–∫–∞ –∏–∑ 4 —Å–ª–æ—Ç–æ–≤
- `MonsterCard.tsx` ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ –º–æ–Ω—Å—Ç—Ä–∞ —Å –ø—Ä–µ–≤—å—é
- `MonsterSelectModal.tsx` ‚Äî –º–æ–¥–∞–ª–∫–∞ –≤—ã–±–æ—Ä–∞ –º–æ–Ω—Å—Ç—Ä–∞
- `StoryTextSelectModal.tsx` ‚Äî –º–æ–¥–∞–ª–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞
- `FeelingLuckyButton.tsx` ‚Äî –∫–Ω–æ–ø–∫–∞ —Ä–∞–Ω–¥–æ–º–∞

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### RBAC –ø—Ä–∞–≤–∏–ª–∞

| –†–æ–ª—å | –î–æ—Å—Ç—É–ø |
|------|--------|
| **SUPERADMIN / MODERATOR** | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ `/admin/monsters` –∏ `/admin/story-pool` (CRUD, unlock) |
| **MASTER** | –î–æ—Å—Ç—É–ø –∫ –≤—ã–±–æ—Ä—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–æ–≤, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ |
| **PLAYER** | –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ (–ø–ª–∞–Ω –≤–∏–¥—è—Ç) |

### –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```typescript
// Middleware –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏
if (!['MODERATOR', 'SUPERADMIN'].includes(userRole)) {
  return res.status(403).json({ error: 'Access denied' })
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–∞—Ç–æ–º–∞—Ä–Ω–æ)
const elements = await db.select()
  .from(monsters)
  .where(and(
    eq(monsters.id, monsterId),
    eq(monsters.status, 'AVAILABLE'),
    eq(monsters.isActive, true)
  ))

if (!elements.length) {
  throw new Error('Monster not available')
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ —Å–µ—Ç–∫–µ
const textIds = [locationTextId, mainEventTextId, sideEventTextId]
if (new Set(textIds).size !== textIds.length) {
  throw new Error('Duplicate text elements')
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã

**`packages/db/src/repositories/monstersRepo.test.ts`**
- `create()` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω—Å—Ç—Ä–∞
- `listAvailable()` ‚Äî —Ç–æ–ª—å–∫–æ AVAILABLE –∏ isActive=true
- `lockByReport()` ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –æ—Ç—á—ë—Ç–∞
- `unlock()` ‚Äî —Ä—É—á–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–¥–º–∏–Ω–æ–º
- `checkAvailability()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–ø–∏—Å–∫–∞ ID

**`packages/db/src/repositories/storyTextsRepo.test.ts`**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤

**`packages/db/src/repositories/reportsRepo.test.ts`**
- `createWithNextPlan()` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ —Å –ø–ª–∞–Ω–æ–º
- `approveReport()` ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏
- `getLastApprovedForGroup()` ‚Äî –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç—á—ë—Ç–∞ –≥—Ä—É–ø–ø—ã –¥–ª—è "–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è"

### E2E —Ç–µ—Å—Ç—ã (Playwright)

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ —Å "–ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç"**
1. –ú–∞—Å—Ç–µ—Ä –ª–æ–≥–∏–Ω–∏—Ç—Å—è
2. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞
3. –ù–∞–∂–∏–º–∞–µ—Ç "–ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç"
4. –í—Å–µ 4 —Å–ª–æ—Ç–∞ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è
5. –í–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–ª–∞–Ω
6. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á—ë—Ç ‚Üí —Å—Ç–∞—Ç—É—Å PENDING
7. –ê–¥–º–∏–Ω –æ–¥–æ–±—Ä—è–µ—Ç ‚Üí —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è LOCKED

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø**
1. –î–≤–∞ –º–∞—Å—Ç–µ—Ä–∞ (–≤ —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö) —Å–æ–∑–¥–∞—é—Ç –æ—Ç—á—ë—Ç—ã
2. –û–±–∞ –≤—ã–±–∏—Ä–∞—é—Ç –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –º–æ–Ω—Å—Ç—Ä–∞
3. –ü–µ—Ä–≤—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á—ë—Ç ‚Üí —É—Å–ø–µ—Ö
4. –ê–¥–º–∏–Ω –æ–¥–æ–±—Ä—è–µ—Ç –ø–µ—Ä–≤—ã–π –æ—Ç—á—ë—Ç ‚Üí –º–æ–Ω—Å—Ç—Ä LOCKED
5. –í—Ç–æ—Ä–æ–π –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å ‚Üí –æ—à–∏–±–∫–∞ 409
6. –í–∏–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ
7. –í—ã–±–∏—Ä–∞–µ—Ç –¥—Ä—É–≥–æ–≥–æ –º–æ–Ω—Å—Ç—Ä–∞ ‚Üí —É—Å–ø–µ—Ö

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ–π —Å–µ—Å—Å–∏–∏**
1. –ú–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞—ë—Ç –æ—Ç—á—ë—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã –ê ‚Üí –æ–¥–æ–±—Ä–µ–Ω ‚Üí —ç–ª–µ–º–µ–Ω—Ç—ã LOCKED
2. –ú–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –æ—Ç—á—ë—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã –ê
3. –í–∫–ª—é—á–∞–µ—Ç —á–µ–∫–±–æ–∫—Å "–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ"
4. –°–µ—Ç–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –æ—Ç—á—ë—Ç–∞
5. –°–ª–æ—Ç—ã disabled (–Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å)
6. –ú–∞—Å—Ç–µ—Ä –¥–æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø–ª–∞–Ω–∞
7. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ‚Üí —É—Å–ø–µ—Ö (—ç–ª–µ–º–µ–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è LOCKED –∑–∞ —ç—Ç–æ–π –≥—Ä—É–ø–ø–æ–π)

**–°—Ü–µ–Ω–∞—Ä–∏–π 4: –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∏ –æ—Ç–∫–∞—Ç**
1. –ú–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞—ë—Ç –æ—Ç—á—ë—Ç —Å —Å–µ—Ç–∫–æ–π ‚Üí PENDING
2. –ê–¥–º–∏–Ω –æ—Ç–∫–ª–æ–Ω—è–µ—Ç (REJECTED) ‚Üí —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è AVAILABLE
3. –ú–∞—Å—Ç–µ—Ä —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –æ—Ç—á—ë—Ç, –º–µ–Ω—è–µ—Ç —Å–µ—Ç–∫—É
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–Ω–æ–≤–∞ ‚Üí PENDING
5. –ê–¥–º–∏–Ω –æ–¥–æ–±—Ä—è–µ—Ç ‚Üí —ç–ª–µ–º–µ–Ω—Ç—ã LOCKED

**–°—Ü–µ–Ω–∞—Ä–∏–π 5: –ê–¥–º–∏–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç —ç–ª–µ–º–µ–Ω—Ç**
1. –ú–æ–Ω—Å—Ç—Ä –≤ —Å—Ç–∞—Ç—É—Å–µ LOCKED
2. –ê–¥–º–∏–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `/admin/monsters`
3. –ù–∞–∂–∏–º–∞–µ—Ç "–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
4. –ú–æ–Ω—Å—Ç—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è AVAILABLE
5. –î—Ä—É–≥–∏–µ –º–∞—Å—Ç–µ—Ä–∞ –≤–∏–¥—è—Ç –µ–≥–æ –≤ –≤—ã–±–æ—Ä–µ

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ

### Packages

#### `packages/contracts/src/enums.ts`
```typescript
export enum StoryTextType {
  LOCATION = 'LOCATION',
  MAIN_EVENT = 'MAIN_EVENT',
  SIDE_EVENT = 'SIDE_EVENT',
}

export enum ElementStatus {
  AVAILABLE = 'AVAILABLE',
  LOCKED = 'LOCKED',
}
```

#### `packages/contracts/src/dto.ts`
```typescript
// –ú–æ–Ω—Å—Ç—Ä—ã
export const MonsterDto = z.object({
  id: z.string().uuid(),
  title: z.string().min(1).max(200),
  imageUrl: z.string().url().nullable(),
  description: z.string().min(1),
  lastKnownLocation: z.string().max(200).nullable(),
  bountyAlive: z.number().int().positive().nullable(),
  bountyDead: z.number().int().positive().nullable(),
  status: z.enum(['AVAILABLE', 'LOCKED']),
  isActive: z.boolean(),
})

export const CreateMonsterDto = MonsterDto.pick({
  title: true,
  imageUrl: true,
  description: true,
  lastKnownLocation: true,
  bountyAlive: true,
  bountyDead: true,
})

// –¢–µ–∫—Å—Ç–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
export const StoryTextDto = z.object({
  id: z.string().uuid(),
  type: z.enum(['LOCATION', 'MAIN_EVENT', 'SIDE_EVENT']),
  text: z.string().min(1).max(1000),
  status: z.enum(['AVAILABLE', 'LOCKED']),
  isActive: z.boolean(),
})

export const CreateStoryTextDto = StoryTextDto.pick({
  type: true,
  text: true,
})

// –ü–ª–∞–Ω —Å–ª–µ–¥—É—é—â–µ–π –∏–≥—Ä—ã
export const ReportNextPlanDto = z.object({
  continuedFromReportId: z.string().uuid().nullable().optional(),
  nextPlanText: z.string().min(1).max(2000),
  monsterId: z.string().uuid(),
  locationTextId: z.string().uuid(),
  mainEventTextId: z.string().uuid(),
  sideEventTextId: z.string().uuid(),
})

// –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ CreateReportDto
export const CreateReportDto = z.object({
  groupId: z.string().uuid(), // NEW!
  description: z.string().min(50),
  players: z.array(z.string().uuid()).min(1),
  nextPlan: ReportNextPlanDto, // NEW!
})

// Feeling Lucky Response
export const FeelingLuckyResponseDto = z.object({
  monsterId: z.string().uuid(),
  locationTextId: z.string().uuid(),
  mainEventTextId: z.string().uuid(),
  sideEventTextId: z.string().uuid(),
  elements: z.object({
    monster: MonsterDto,
    location: StoryTextDto,
    mainEvent: StoryTextDto,
    sideEvent: StoryTextDto,
  }),
})
```

### Repositories

#### `packages/db/src/repositories/monstersRepo.ts`
```typescript
export const monstersRepo = {
  // –ê–¥–º–∏–Ω CRUD
  async list(filters: { status?, isActive?, search?, page?, limit? }) { ... },
  async create(data: CreateMonsterDto) { ... },
  async update(id: string, data: Partial<CreateMonsterDto>) { ... },
  async delete(id: string) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å LOCKED
    const monster = await this.getById(id)
    if (monster.status === 'LOCKED') {
      throw new Error('Cannot delete locked monster')
    }
    await db.delete(monsters).where(eq(monsters.id, id))
  },
  
  // –í—ã–±–æ—Ä –º–∞—Å—Ç–µ—Ä–æ–º
  async listAvailable(search?: string, limit = 50) {
    return db.select()
      .from(monsters)
      .where(and(
        eq(monsters.status, 'AVAILABLE'),
        eq(monsters.isActive, true),
        search ? ilike(monsters.title, `%${search}%`) : undefined
      ))
      .limit(limit)
  },
  
  // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –æ—Ç—á—ë—Ç–∞
  async lockByReport(monsterId: string, reportId: string, groupId: string) {
    await db.update(monsters)
      .set({
        status: 'LOCKED',
        lockedByReportId: reportId,
        lockedByGroupId: groupId,
        lockedAt: new Date(),
        updatedAt: new Date(),
      })
      .where(and(
        eq(monsters.id, monsterId),
        eq(monsters.status, 'AVAILABLE') // –∞—Ç–æ–º–∞—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
      ))
  },
  
  // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–¥–º–∏–Ω–æ–º
  async unlock(monsterId: string) {
    await db.update(monsters)
      .set({
        status: 'AVAILABLE',
        lockedByReportId: null,
        lockedByGroupId: null,
        lockedAt: null,
        updatedAt: new Date(),
      })
      .where(eq(monsters.id, monsterId))
  },
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (–¥–ª—è –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
  async checkAvailability(monsterIds: string[]) {
    const results = await db.select({ id: monsters.id })
      .from(monsters)
      .where(and(
        inArray(monsters.id, monsterIds),
        eq(monsters.status, 'AVAILABLE'),
        eq(monsters.isActive, true)
      ))
    
    return results.map(r => r.id)
  },
}
```

#### `packages/db/src/repositories/storyTextsRepo.ts`
–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ `monstersRepo`, —Å —É—á—ë—Ç–æ–º `type` –ø–æ–ª—è.

#### `packages/db/src/repositories/reportsRepo.ts`
```typescript
export const reportsRepo = {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã
  
  async createWithNextPlan(data: CreateReportDto, masterId: string) {
    return db.transaction(async (tx) => {
      // 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
      const availableMonsters = await monstersRepo.checkAvailability([data.nextPlan.monsterId])
      const availableTexts = await storyTextsRepo.checkAvailability([
        data.nextPlan.locationTextId,
        data.nextPlan.mainEventTextId,
        data.nextPlan.sideEventTextId,
      ])
      
      if (!availableMonsters.includes(data.nextPlan.monsterId)) {
        throw new ConflictError('Monster not available', { monsterId: 'LOCKED' })
      }
      
      if (availableTexts.length !== 3) {
        // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
        const conflicts = {}
        if (!availableTexts.includes(data.nextPlan.locationTextId)) conflicts.locationTextId = 'LOCKED'
        if (!availableTexts.includes(data.nextPlan.mainEventTextId)) conflicts.mainEventTextId = 'LOCKED'
        if (!availableTexts.includes(data.nextPlan.sideEventTextId)) conflicts.sideEventTextId = 'LOCKED'
        throw new ConflictError('Some texts not available', conflicts)
      }
      
      // 2. –°–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç
      const [report] = await tx.insert(reports).values({
        groupId: data.groupId,
        masterId,
        description: data.description,
        status: 'PENDING',
      }).returning()
      
      // 3. –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω
      await tx.insert(reportNextPlans).values({
        reportId: report.id,
        ...data.nextPlan,
      })
      
      // 4. –°–æ–∑–¥–∞—Ç—å —Å–≤—è–∑–∏ —Å –∏–≥—Ä–æ–∫–∞–º–∏
      await tx.insert(reportPlayers).values(
        data.players.map(playerId => ({
          reportId: report.id,
          playerId,
        }))
      )
      
      return report
    })
  },
  
  async approveReport(reportId: string) {
    return db.transaction(async (tx) => {
      // 1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ—Ç—á—ë—Ç–∞
      await tx.update(reports)
        .set({ status: 'APPROVED', updatedAt: new Date() })
        .where(eq(reports.id, reportId))
      
      // 2. –ü–æ–ª—É—á–∏—Ç—å –ø–ª–∞–Ω –∏ groupId
      const [report] = await tx.select({ groupId: reports.groupId })
        .from(reports)
        .where(eq(reports.id, reportId))
      
      const [plan] = await tx.select()
        .from(reportNextPlans)
        .where(eq(reportNextPlans.reportId, reportId))
      
      // 3. –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
      await monstersRepo.lockByReport(plan.monsterId, reportId, report.groupId)
      await storyTextsRepo.lockByReport(plan.locationTextId, reportId, report.groupId)
      await storyTextsRepo.lockByReport(plan.mainEventTextId, reportId, report.groupId)
      await storyTextsRepo.lockByReport(plan.sideEventTextId, reportId, report.groupId)
      
      // 4. –°–ø–∏—Å–∞—Ç—å –±–∞—Ç—Ç–ª–ø–∞—Å—Å—ã (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞)
      await battlepassesRepo.redeemForReport(reportId)
      
      // 5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞)
      await notificationsRepo.notifyReportApproved(reportId)
    })
  },
  
  async getLastApprovedForGroup(groupId: string) {
    const [report] = await db.select()
      .from(reports)
      .where(and(
        eq(reports.groupId, groupId),
        eq(reports.status, 'APPROVED')
      ))
      .orderBy(desc(reports.createdAt))
      .limit(1)
    
    if (!report) return null
    
    const [plan] = await db.select()
      .from(reportNextPlans)
      .where(eq(reportNextPlans.reportId, report.id))
    
    return { report, plan }
  },
}
```

---

## üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–æ—Ä—è–¥–æ–∫ –∑–∞–¥–∞—á)

### –§–∞–∑–∞ 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `monsters`
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å enum `story_text_type` –∏ —Ç–∞–±–ª–∏—Ü—É `story_texts`
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å `groupId` –≤ —Ç–∞–±–ª–∏—Ü—É `reports`
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `report_next_plans`
5. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
6. ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å —Å–∏–¥—ã (10-20 –º–æ–Ω—Å—Ç—Ä–æ–≤, 20-40 —Ç–µ–∫—Å—Ç–æ–≤ –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–∏–ø—É)

### –§–∞–∑–∞ 2: –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å enums –∏ DTO –≤ `packages/contracts`
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å `monstersRepo.ts`
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å `storyTextsRepo.ts`
4. ‚úÖ –†–∞—Å—à–∏—Ä–∏—Ç—å `reportsRepo.ts`
5. ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

### –§–∞–∑–∞ 3: API (–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)
1. ‚úÖ `GET/POST/PATCH/DELETE /api/admin/monsters`
2. ‚úÖ `POST /api/admin/monsters/:id/unlock`
3. ‚úÖ `GET/POST/PATCH/DELETE /api/admin/story-texts`
4. ‚úÖ `POST /api/admin/story-texts/:id/unlock`

### –§–∞–∑–∞ 4: API (–ú–∞—Å—Ç–µ—Ä)
1. ‚úÖ `GET /api/story-pool/monsters/available`
2. ‚úÖ `GET /api/story-pool/texts/available`
3. ‚úÖ `POST /api/story-pool/feeling-lucky`
4. ‚úÖ –†–∞—Å—à–∏—Ä–∏—Ç—å `POST /api/reports` (—Å nextPlan)
5. ‚úÖ –†–∞—Å—à–∏—Ä–∏—Ç—å `PATCH /api/reports/:id` (–º–æ–¥–µ—Ä–∞—Ü–∏—è —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π)

### –§–∞–∑–∞ 5: UI (–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/admin/monsters`
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/admin/story-pool`
3. ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: —Ç–∞–±–ª–∏—Ü—ã, —Ñ–æ—Ä–º—ã, –º–æ–¥–∞–ª–∫–∏
4. ‚úÖ –ö–Ω–æ–ø–∫–∞ "–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

### –§–∞–∑–∞ 6: UI (–ú–∞—Å—Ç–µ—Ä)
1. ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `NextGamePlanBlock.tsx`
2. ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `StoryGridSelector.tsx`
3. ‚úÖ –ú–æ–¥–∞–ª–∫–∏ –≤—ã–±–æ—Ä–∞ –º–æ–Ω—Å—Ç—Ä–æ–≤/—Ç–µ–∫—Å—Ç–æ–≤
4. ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç"
5. ‚úÖ –ß–µ–∫–±–æ–∫—Å "–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ" —Å –ª–æ–≥–∏–∫–æ–π –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è
6. ‚úÖ Textarea —Å —Å—á—ë—Ç—á–∏–∫–æ–º —Å–∏–º–≤–æ–ª–æ–≤
7. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (409) —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏

### –§–∞–∑–∞ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–ª–∏—Ä–æ–≤–∫–∞
1. ‚úÖ E2E —Ç–µ—Å—Ç—ã (5 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤—ã—à–µ)
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∏–Ω–¥–µ–∫—Å—ã)
3. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases
4. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (README, TECHNICAL_DOCUMENTATION)

---

## üìä –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

| –§–∞–∑–∞ | –ó–∞–¥–∞—á | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è |
|------|-------|-----------|-------|
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | 6 | –ù–∏–∑–∫–∞—è | 2-3 —á–∞—Å–∞ |
| –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã/–†–µ–ø–æ | 5 | –°—Ä–µ–¥–Ω—è—è | 4-5 —á–∞—Å–æ–≤ |
| API –ê–¥–º–∏–Ω | 4 | –ù–∏–∑–∫–∞—è | 3-4 —á–∞—Å–∞ |
| API –ú–∞—Å—Ç–µ—Ä | 5 | –í—ã—Å–æ–∫–∞—è | 6-8 —á–∞—Å–æ–≤ |
| UI –ê–¥–º–∏–Ω | 4 | –°—Ä–µ–¥–Ω—è—è | 5-6 —á–∞—Å–æ–≤ |
| UI –ú–∞—Å—Ç–µ—Ä | 7 | –í—ã—Å–æ–∫–∞—è | 10-12 —á–∞—Å–æ–≤ |
| –¢–µ—Å—Ç—ã | 4 | –°—Ä–µ–¥–Ω—è—è | 4-6 —á–∞—Å–æ–≤ |
| **–ò–¢–û–ì–û** | **35** | - | **34-44 —á–∞—Å–∞** |

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (DoD)

- [ ] –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã, —Å–∏–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Unit-—Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (>80%)
- [ ] –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–Ω—Å—Ç—Ä–æ–≤ –∏ —Ç–µ–∫—Å—Ç—ã
- [ ] –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã
- [ ] –ú–∞—Å—Ç–µ—Ä –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
- [ ] –ö–Ω–æ–ø–∫–∞ "–ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç" –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–∞–ª–∏–¥–Ω—É—é —Å–µ—Ç–∫—É
- [ ] –ß–µ–∫–±–æ–∫—Å "–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ" –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –ø—Ä–æ—à–ª—É—é —Å–µ—Ç–∫—É
- [ ] –ü—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ (409) –º–∞—Å—Ç–µ—Ä –≤–∏–¥–∏—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
- [ ] –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –æ—Ç—á—ë—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞
- [ ] –ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –æ—Ç—á—ë—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏
- [ ] E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (5/5)
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### –ü—Ä–∏–º–µ—Ä—ã —Å–∏–¥–æ–≤

**–ú–æ–Ω—Å—Ç—Ä—ã:**
```typescript
{
  title: '–ö—Ä–æ–≤–∞–≤—ã–π –î—Ä–∞–∫–æ–Ω –¢–µ–Ω–µ–±—Ä–∏—Å–∞',
  imageUrl: '/monsters/dragon-001.jpg',
  description: '–î—Ä–µ–≤–Ω–∏–π –∫—Ä–∞—Å–Ω—ã–π –¥—Ä–∞–∫–æ–Ω, —Ç–µ—Ä—Ä–æ—Ä–∏–∑–∏—Ä—É—é—â–∏–π —Ç–æ—Ä–≥–æ–≤—ã–µ –ø—É—Ç–∏. –ò–∑–≤–µ—Å—Ç–µ–Ω —Å–≤–æ–µ–π –∂–µ—Å—Ç–æ–∫–æ—Å—Ç—å—é –∏ –ª—é–±–æ–≤—å—é –∫ –∑–æ–ª–æ—Ç—É.',
  lastKnownLocation: '–ü–µ—â–µ—Ä—ã –û–≥–Ω–µ–Ω–Ω–æ–π –ì–æ—Ä—ã',
  bountyAlive: 50000,
  bountyDead: 25000,
}
```

**–õ–æ–∫–∞—Ü–∏–∏:**
```typescript
{ type: 'LOCATION', text: '–ó–∞–±—Ä–æ—à–µ–Ω–Ω—ã–π —Ö—Ä–∞–º –≤ –ª–µ—Å—É –í–µ—á–Ω–æ–π –ù–æ—á–∏' }
{ type: 'LOCATION', text: '–ü–æ–¥–∑–µ–º–µ–ª—å—è –ø–æ–¥ –∫–æ—Ä–æ–ª–µ–≤—Å–∫–∏–º –¥–≤–æ—Ä—Ü–æ–º' }
{ type: 'LOCATION', text: '–õ–µ—Ç–∞—é—â–∏–π –æ—Å—Ç—Ä–æ–≤ –º–∞–≥–æ–≤' }
```

**–°–æ–±—ã—Ç–∏—è:**
```typescript
{ type: 'MAIN_EVENT', text: '–ü–æ—Ö–∏—â–µ–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞ –ø—Ä–µ—Å—Ç–æ–ª–∞' }
{ type: 'MAIN_EVENT', text: '–û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞–ª–∞ –≤ –¥—Ä—É–≥–æ–π –º–∏—Ä' }
{ type: 'SIDE_EVENT', text: '–í—Å—Ç—Ä–µ—á–∞ —Å–æ —Å—Ç—Ä–∞–Ω—Å—Ç–≤—É—é—â–∏–º —Ç–æ—Ä–≥–æ–≤—Ü–µ–º' }
{ type: 'SIDE_EVENT', text: '–ù–∞–ø–∞–¥–µ–Ω–∏–µ –±–∞–Ω–¥–∏—Ç–æ–≤ –Ω–∞ –∫–∞—Ä–∞–≤–∞–Ω' }
```

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π

- [x] –ë–µ–∑ TTL/—Ä–µ–∑–µ—Ä–≤–æ–≤ ‚Äî –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
- [x] –ú–æ–Ω—Å—Ç—Ä—ã ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏ —Ä–∞–∑–¥–µ–ª –∞–¥–º–∏–Ω–∫–∏
- [x] –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è ‚Äî –µ–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `story_texts`
- [x] –î–æ–±–∞–≤–ª–µ–Ω `groupId` –≤ —Ç–∞–±–ª–∏—Ü—É `reports`
- [x] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞–≤—Å–µ–≥–¥–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä—É—á–Ω–æ–≥–æ unlock
- [x] "–ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç" –≤ MVP
- [x] –õ–∏–º–∏—Ç `nextPlanText` ‚Äî 2000 —Å–∏–º–≤–æ–ª–æ–≤
- [x] "–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ" –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π APPROVED –æ—Ç—á—ë—Ç –≥—Ä—É–ø–ø—ã

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏! üöÄ**

–ï—Å–ª–∏ –µ—Å—Ç—å –µ—â—ë –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –Ω—É–∂–Ω—ã —É—Ç–æ—á–Ω–µ–Ω–∏—è ‚Äî –ø–∏—à–∏.

