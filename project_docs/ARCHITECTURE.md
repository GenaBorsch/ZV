## Архитектурный обзор

### Цели проекта
- Личные кабинеты игроков и мастеров для НРИ «Звёздное Веретено»
- Админ-панель для управления сезонами, группами, сессиями, товарами и заказами
- Монорепозиторий с едиными контрактами типов и общими пакетами

### Технологический стек
- **Frontend**: Next.js 15 (App Router) + React 18 + TypeScript
- **UI**: Tailwind CSS + shadcn/ui (utility-first + headless-компоненты)
- **Backend**: Next.js API Routes + Server Actions (BFF)
- **База данных**: PostgreSQL + Drizzle ORM
- **Аутентификация**: NextAuth (план: email magic-link + Telegram OAuth)
- **Хранилище файлов**: MinIO (совместим с S3)
- **Платежи**: YooKassa 

### Монорепозиторий
Структура:
```
apps/
  web/            # Next.js приложение (UI + API)
packages/
  db/             # Prisma схема, сиды, генерация клиента
  contracts/      # DTO/Enums/Events, разделяемые типы API
  ui/             # UI-кит (в заделе)
  utils/          # Общие утилиты (валидация, даты, роли)
```

Менеджер пакетов: pnpm, рабочее пространство описано в `pnpm-workspace.yaml`.

### Границы модулей
- `apps/web`: web-клиент и BFF-слой. Использует `@zv/db` (Drizzle ORM) и типы из `contracts`.
- `packages/db`: поставляет Drizzle-схему/миграции для Node-окружения.
- `packages/contracts`: единый источник истины для DTO, enum и событий домена.
- `packages/ui`: общий дизайн-системный слой (пока без содержимого).
- `packages/utils`: общие функции (`cn`, `validation`, `roles`, `date`).

### Разделение ответственности
- Валидация входных данных и контрактов — пакет `contracts` (zod-схемы).
- Доступ к данным — пакет `db` через Prisma Client.
- Представление и маршрутизация — `apps/web` (App Router).
- Хранение файлов — MinIO, доступ из серверной части.

### Инфраструктура
- Docker Compose поднимает PostgreSQL, MinIO.
- ENV-конфигурация через `.env` (см. примеры в `env.example`).

### Безопасность и доступ
- NextAuth (секрет и URL из ENV). Права — через `Role` и профили (`PlayerProfile`, `MasterProfile`). Роли: PLAYER, MASTER, MODERATOR, SUPERADMIN.
- CORS для `/api/*` настроен в `next.config.js` (разрешены методы и заголовки).

### Бизнес-потоки (высокоуровнево)
- Регистрация/логин пользователя → создание профилей по необходимости.
- Формирование сезонов → группы мастеров → сессии.
- Игроки записываются на сессии (enrollment), мастер подтверждает.
- Мастер заполняет отчёты по сессиям.
- Магазин: товары (в т.ч. баттлпассы) → заказы → оплата (YooKassa) → активация/списание баттлпассов.


