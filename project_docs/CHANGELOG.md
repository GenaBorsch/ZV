# Changelog

Все значимые изменения в проекте "Звёздное Веретено" документируются в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и этот проект придерживается [Semantic Versioning](https://semver.org/lang/ru/).

---

## [1.0.0] - Декабрь 2024

### Добавлено
- **Система управления пользователями** с регистрацией и аутентификацией
- **Управление группами НРИ** с поиском и подачей заявок
- **Система баттлпассов** с различными типами путёвок
- **Платежная интеграция** с YooKassa
- **Файловое хранилище** на базе MinIO
- **Система отчетов** для мастеров
- **Story Pool** — база игровых элементов (монстры, текстовые события)
- **Система персонажей** — полный CRUD для управления персонажами игроков
- **Админ-панель** для управления системой
- **Юридические документы** и согласие пользователей
- **Адаптивный дизайн** для всех устройств

### Исправлено
- **Октябрь 2024** Консолидация документации проекта:
  - Созданы новые документы: `LEGAL_DOCUMENTS.md`
  - Все документы собраны в папку `project_docs/` для лучшей организации
  - Обновлены перекрестные ссылки между всеми документами
  - Добавлена информация о юридических документах и правовом соответствии

- **Сентябрь 2024** Очистка проекта от устаревших данных:
  - Удалены устаревшие файлы развертывания из архива
  - Удалены HTML файлы Tilda и связанные ресурсы
  - Консолидированы инструкции по развертыванию в единое руководство
  - Актуализированы даты последних обновлений во всех документах

- **Сентябрь 2024** Отображение изображений товаров:
  - Исправлена проблема с отображением изображений баттлпассов из-за ошибки 403 Access Denied при прямом обращении к MinIO
  - Создан новый API endpoint `/api/files/[...path]` для безопасного проксирования файлов
  - Обновлён компонент `ProductImage` для автоматического использования API вместо прямых URL
  - Добавлено кэширование файлов с поддержкой ETag
  - Обеспечена поддержка всех типов изображений (JPEG, PNG, GIF, WebP, SVG)

### Добавлено (детали)

#### Сентябрь 2024 - Юридические документы и согласие пользователей
- **Страница `/legal`** с полными юридическими документами
- **Публичная оферта** — условия использования платформы
- **Политика конфиденциальности** — обработка персональных данных по ФЗ-152
- **Вкладочный интерфейс** для удобной навигации между документами
- **Responsive дизайн** с адаптацией под мобильные устройства
- **Обязательное согласие** при регистрации:
  - Галочка согласия в форме регистрации
  - Валидация на клиенте — невозможно зарегистрироваться без согласия
  - Валидация на сервере — дополнительная проверка в API
  - Ссылка на документы из формы регистрации (открывается в новой вкладке)

#### Сентябрь 2024 - API для доступа к файлам
- Новый endpoint `GET /api/files/[...path]` для безопасного получения файлов из MinIO
- Автоматическое определение Content-Type по расширению файла
- Кэширование на 1 час для оптимизации производительности
- Поддержка ETag для условных запросов
- Доступ только к публичным bucket'ам (`uploads`, `avatars`)

#### Сентябрь 2024 - Система отчётов мастеров
- **Полный цикл отчётности** с модерацией
- **Story Pool** — выбор игровых элементов для следующей игры:
  - Монстры с карточками
  - Текстовые элементы (локации, события)
  - Система блокировки использованных элементов
  - Кнопка "Мне повезёт" для случайной генерации
- **Автоматическое списание** игр из баттлпассов при одобрении
- **Система уведомлений** для всех участников процесса
- **История отчётов** для игроков, мастеров и админов
- **Валидация и безопасность** (rate limiting, проверка прав)

#### Сентябрь 2024 - Исправления критических ошибок
- ✅ **Ошибка foreign key constraint** — убрана зависимость от seasonId в баттлпассах
- ✅ **Ошибка валидации CUID vs UUID** — исправлены схемы валидации для работы с UUID
- ✅ **Ошибка orderBy в API отчетов** — добавлен импорт `desc` из drizzle-orm
- ✅ **Проблема с поиском игроков** — заменен на безопасную систему выбора из групп

#### Сентябрь 2024 - Улучшения UX
- ✅ **Счетчик оставшихся игр** в интерфейсе баттлпассов
- ✅ **Групповая система создания отчетов** — мастер выбирает группу → игроков из группы
- ✅ **Обновленная типографика**: Внедрены кастомные шрифты
- ✅ **Увеличенные размеры шрифтов**: Улучшена читаемость во всех интерфейсах
- ✅ **Консистентные размеры кнопок**: Все кнопки приведены к единому стандарту
- ✅ **Исправлена читаемость**: Устранены проблемы с контрастом

#### Сентябрь 2024 - Система персонажей
- ✅ **Полное CRUD API** для персонажей (`/api/v1/characters`)
- ✅ **UI компоненты** с обновленным дизайном
- ✅ **Схема базы данных** для персонажей с поддержкой архетипов и статусов
- ✅ **Интеграция в кабинет игрока** — создание, редактирование, просмотр персонажей
- ✅ **Загрузка аватаров** через MinIO с поддержкой различных форматов
- ✅ **Валидация данных** через Zod схемы
- ✅ **Лимиты персонажей** (максимум 5 на игрока)

---

## [Unreleased]

### Планируется
- Система игровых сессий (расписание, запись на игры)
- Telegram OAuth интеграция
- Real-time уведомления через WebSocket/SSE
- Расширенная аналитика и метрики
- PWA функционал

---

**Последнее обновление:** Декабрь 2024
